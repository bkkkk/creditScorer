---
title: "Exploration"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(randomForest)
library(readr)
library(dplyr)
library(ggplot2)
library(scales)

source("R/func-NA.R")
source("R/func-clean.R")
source("R/01-load.R")
source("R/02-clean.R")
```

## Problem statement

Given a large data set of client financial information, attempt to determine if a given client will default on their payment. In this case the default payment is defined as failing to make a payment 90 days after the due date.

## Dataset

Two datasets were used for this study one for training and one for testing with `r nrow(raw_tr)` and `r nrow(raw_tr)` entries respectively. Each set includes 10 predictors, with the training set also including a response variable. These include information about the borrower's income, age, and number of dependants; number of lines of credit; and how many times the borrower missed a due date by as much as 60, 90, or more than 90 days. The full list of variables is included at the end of the report.

The training dataset contains `r sum(nacols(raw_tr))` predictors with missing values, namely `r nacols_name(raw_tr)` with `r sum(is.na(raw_tr))` entries in the dataset containing missing values.

Specifically, `r nacol_percent(raw_tr$MonthlyIncome)`% of the monthly income data is missing while `r nacol_percent(raw_tr$NumberOfDependents)` of the entries are missing the measurement of the number of dependents.

## Data exploration

A data summary shows that the dataset contains a wide range of borrowers in age (21 to 109), income (no income to 3 million), and number of dependants (upto 20).

The dataset contains an overwhelming majority of negative examples, `r 100*mutate(count(clean_tr, seriousDlqin), occ = n/sum(n))$occ[1]`% of the data corresponds to clients who have not failed to make a payment within 90 days of the due date in the last two years.

### Age

As mentioned before the borrowers in the data represent a wide cross-section of the population. The age distribution shows that borrows as young as 21 and as old as 90+ are included in the dataset.

```{r age-dirty}
clean_tr %>%
  ggplot(aes(age, fill = seriousDlqin)) +
  geom_bar() +
  scale_fill_brewer(name = "Delinquent Past Due", type = "qual", palette = "Set1") +
  # theme_hrbrmstr() +
  theme(legend.position = "bottom") +
  labs(title = "Applicant Age",
       x = "Age",
       y = "")
```

A single entry in the dataset was a misrecorded with an age of zero. This was corrected to the median age for the rest of the analysis.

```{r age-clean}
clean_tr %>%
  clean_credit_score_age() %>%
  ggplot(aes(age, fill = seriousDlqin)) + geom_bar() +
  scale_fill_brewer(name = "Delinquent Past Due", type = "qual", palette = "Set1") +
  # theme_hrbrmstr() + 
  theme(legend.position = "bottom") +
  labs(title = "Applicant Age",
       x = "Age",
       y = "")
```

### Number of Dependents

This variable describes the number of dependants registered under the borrower. As expected, the majority of borrowers have less than 3 dependants, with the number of borrowers decreasing rapidly with number of dependants. There are a number of 

```{r number-of-deps}
clean_tr %>%
  ggplot(aes(seriousDlqin, nDependents)) + geom_boxplot() +
  # theme_hrbrmstr() +
  theme(legend.position = "bottom") +
  labs(title = "Number of Dependants",
       x = "Defaulted on payment?",
       y = "Number of Dependants")
```

As mentioned before about 2% of the entries have no information about the number of dependants. At this point this data is simply ignored, no attempt is made to infer this missing data.

### Times borrowers 30-59 days past due date

This variables describes the number of times the borrower has failed to pay 30 to 59 days past the due date but no more.

```{r past-due-30-dirty}
clean_tr %>%
  ggplot(aes(pastDue30, fill = seriousDlqin)) + geom_bar() +
  scale_fill_brewer(name = "Delinquent Past Due", type = "qual", palette = "Set1") +
  # theme_hrbrmstr() +
  theme(legend.position = "bottom") +
  labs(title = "Times Past Due (30-59 Days)",
       # subtitle = "Distribution bulk",
       x = "Times Past Due",
       y = "")
```

This variable contains a few entries at 96 and 98, these are likely encodings for missing values or other special cases. A value of 96 or 98 in one pastDue variable coincides with 96 or 98 value in the other two pastDue variables. 5 out of all borrowers in the data have a status code 96, while 264 have a past due value code of 98. Having these values be the same across pastDue variables suggest these are status codes. These are likely associated with borrowers that refused to provide the information or are new to the company collecting the data.

Since these observations make up a small portion of the data, the status codes were simply replaced with the median of the rest of the pastDue distribution.

```{r past-due-30-cleam}
clean_tr %>%
  clean_credit_score_pastDue30() %>%
  ggplot(aes(pastDue30, fill = seriousDlqin)) + geom_bar() +
  scale_fill_brewer(name = "Delinquent Past Due", type = "qual", palette = "Set1") +
  # theme_hrbrmstr() +
  theme(legend.position = "bottom") +
  labs(title = "Times Past Due (30-59 Days)",
       # subtitle = "Distribution bulk",
       x = "Times Past Due",
       y = "")
```

### Times borrowers 60-89 days past due date

Similar to the aforementioned variable except for a period of 60 to 89 past the due date and no more.

```{r past-due-60-dirty}
clean_tr %>%
  ggplot(aes(pastDue60, fill = seriousDlqin)) + geom_bar() +
  scale_fill_brewer(name = "Delinquent Past Due", type = "qual", palette = "Set1") +
  # theme_hrbrmstr() +
  theme(legend.position = "bottom") +
  labs(title = "Times Past Due (60-89 Days)",
       x = "Times Past Due",
       y = "")
```

We take the same procedure here to remove entries with value 96 and 98.

```{r past-due-60-clean}
clean_tr %>%
  clean_credit_score_pastDue60() %>%
  ggplot(aes(pastDue60, fill = seriousDlqin)) + geom_bar() +
  scale_fill_brewer(name = "Delinquent Past Due", type = "qual", palette = "Set1") +
  # theme_hrbrmstr() +
  theme(legend.position = "bottom") +
  labs(title = "Times Past Due (60-89 Days)",
       x = "Times Past Due",
       y = "")
```

### Times more than 90 days past due

The number of times the borrower has failed to make a payment 90 days past the due date.

```{r}
clean_tr %>%
  ggplot(aes(pastDue90, fill = seriousDlqin)) + geom_bar() +
  scale_fill_brewer(name = "Delinquent Past Due", type = "qual", palette = "Set1") +
  # theme_hrbrmstr() +
  theme(legend.position = "bottom") +
  labs(title = "Times Past Due (90+ Days)",
# subtitle = "Distribution bulk",
       caption = "source: www.kaggle.com",
       x = "Times Past Due",
       y = "")
```

We take the same procedure here to remove entries with value 96 and 98.

```{r past-due-90-clean}
clean_tr %>%
  clean_credit_score_pastDue90() %>%
  ggplot(aes(pastDue90, fill = seriousDlqin)) + geom_bar() +
  scale_fill_brewer(name = "Delinquent Past Due", type = "qual", palette = "Set1") +
  # theme_hrbrmstr() +
  theme(legend.position = "bottom") +
  labs(title = "Times Past Due (90+ Days)",
       caption = "source: www.kaggle.com",
       x = "Times Past Due",
       y = "")
```


### Number of Credit lines and Loans

This is the number of credit lines and loans associated with the borrower.

```{r}
clean_tr %>%
  ggplot(aes(nCreditsAndLoans, fill = seriousDlqin)) + geom_bar() +
  scale_fill_brewer(name = "Delinquent Past Due", type = "qual", palette = "Set1") +
  # theme_hrbrmstr() +
  theme(legend.position = "bottom") +
  labs(title = "Number of Credits and Loans",
       caption = "source: www.kaggle.com",
       x = "Credits and Loans",
       y = "")
```

This distribution is surprisingly well behaved following and almost gaussian distribution. There appear to be a few outlier entries with some borrowers having as many as 50+ loans and credit lines. Without any specific domain knowledge to suggest these should be removed, these entries will be left in.

```






```{r}

```






| Name | Desc | Type |
| SeriousDlqin2yrs | Person experienced 90 days past due delinquency or worse | boolean |
| RevolvingUtilizationOfUnsecuredLines | Total Balan ||
